sudo: false
install: true

language: java
jdk:
- openjdk8

addons:
  sonarcloud:
    organization: 'dmitriiserikov-github'
    token:
      secure: 'KEvNRnrKoQFGln6QoqSH3qBC6H/2g9oGQGMKriqiq/YLJ6SI0ZLyEO9qUQGAmoMfw1WM6Hmu7e3p//9znc5hIWAIXPE57LkFn1z5iTqUKmAokCb2fqpoTCOkz0Lze2yVFqysNriXVGfptAckJwV3jeGiTzILDulBKOtvxxI5bZDr3leoXaBZ00XzHZGbGmWGAOc/YRiSGWrGXF+Rf8rJcOQeHjPWg7BsgVSMncHAqKuQk6QEVZB56VX3LXtgyr10P1UUU+GAO/XyQm0OrmPWUhdEe6nAZFGZaLGLNmi430ZqScH8F6vDTe9OYM/fJ/QYbb1BXaMX6Hr7modrUvEwn7w3Nb956BZC4LB2S6RNcZiLC3n/Bg8cMtLp6jfftisYhJLggjwcbDfSN97Oiq8PFCop9i+Okj7enupJ8lHAckFA2ACTgO0+750GEFmwQEFUSQvWHSgISpnsC77JAksPLuYriMNMnpM6/YIPm0DuIkHhfKxsTmRa5dNXjmKo/SHb4qz647CcUqUQVhngdvLYOeB2e6XiTYxDFg1OWkRC0SZUz6z0YeqOxckBAAzZOa2JYRl2/JyRqrA616QdS+EWRZt68RsQC7+JssbYWYf0rcT+GzyqXj8++xle2P5ER2tobgIMGjzWhhzTvPytyHfYBwmdMRDoM5hYKcVcgLnFNSE='

stages:
- test
- deploy

jobs:
  include:
  - stage: test
    script: ./mvnw clean test -P dev
    name: 'Unit tests'
  - stage: test
    script: ./mvnw clean install -P integration-test
    name: 'Integration tests'
  - stage: test
    script: ./mvnw clean jacoco:prepare-agent install sonar:sonar -P sonar
    name: 'Sonar'
  - stage: deploy
    script: skip
    name: "Deploy to Heroku"
    deploy:
      provider: heroku
      api_key:
        secure: 'LNLFiM0yZbN7ylQxALSidtC9e0daju8nQilPOVbhDPjVKpzfzCGLvOsJAYK0zvy7T5i9dcJ7bGmC0v3u0pPwB7ZMP9CAQ6k3wDviF8nSWCj1CQclLv9LCVAbMK3WWdpsDfPzVwchnnI/FhSp/9mDGbQSSGriQqULPrbQ5VQTFOLrfY3JVMt7/xoxai5/EWoc9W8WUKBRcz5y/Lmq84xEyOkB45QfX6JBxO7/6MlQMAYE59+u8dfRwsoUZDyAtJGiNl550WSQ4oX/R8pZYmjesDOCWAJ8ieOHS2VXXZ0RjRTXcCbckRsDEhByLSsZAd+iAleb4PqCUStgZE69DVQT6x9SMJDP7iz5/XleIZHtD9vVetl2udXB/Hi/zpIeC1BA2wm/DvRTY9UqTp3PChWWzyTTde2d/ly+UWnfXqA+v6sfV7grx+uKgFbGUDGU4DLdt4lSdGN4vp/aaIpAN2UiNPD5Z0jr8NeFrBuVLEEN4uWgONMuPs3nIEXU8BCqtkYaKyVKzNIZ+qSL6tt4FhGr8N9Po4tQK3O4eQGuZVISUA11ayQRAO80tS0CuYaYszgqzamAaun4kAvyUxXU5xcD5MMbMIPs06F+esD3cgBzgLETjlD/SQabvVoEs/AJuhLdNIu1KNSuiitO54BfT+AHMIz96BegNoGv9SZdrL01PUA='
      app: money-transfer-service

after_success:
- bash <(curl -s https://codecov.io/bash)

cache:
  directories:
  - '$HOME/.m2/repository'
  - '$HOME/.sonar/cache'